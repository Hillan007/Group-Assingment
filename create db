-- Step 1: Create the bookstore database
CREATE DATABASE bookstore;
USE bookstore;


-- Step 2: Create Publisher and Book Language tables (Referenced by Books)

CREATE TABLE publisher (
    publisher_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE book_language (
    language_id INT PRIMARY KEY AUTO_INCREMENT,
    language_name VARCHAR(50) NOT NULL
);



-- Step 3: Create Books table (Includes foreign keys for publisher and language)
  
CREATE TABLE book (
    book_id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    isbn VARCHAR(20) UNIQUE NOT NULL,
    publication_year YEAR,
    publisher_id INT,
    language_id INT,
    FOREIGN KEY (publisher_id) REFERENCES publisher(publisher_id),
    FOREIGN KEY (language_id) REFERENCES book_language(language_id)
);

  

-- Step 4: Create Authors table
  
CREATE TABLE author (
    author_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL
);

  
-- Step 5: Create Book-Author junction table (Many-to-Many Relationship)
  
CREATE TABLE book_author (
    book_id INT,
    author_id INT,
    PRIMARY KEY (book_id, author_id),
    FOREIGN KEY (book_id) REFERENCES book(book_id),
    FOREIGN KEY (author_id) REFERENCES author(author_id)
);

-- Step 6: Create Customers table
CREATE TABLE customer (
    customer_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL
);
  

-- Step 7: Create Address-related tables
  
CREATE TABLE country (
    country_id INT PRIMARY KEY AUTO_INCREMENT,
    country_name VARCHAR(100) NOT NULL
);

CREATE TABLE address_status (
    status_id INT PRIMARY KEY AUTO_INCREMENT,
    status_name VARCHAR(50) NOT NULL
);

CREATE TABLE address (
    address_id INT PRIMARY KEY AUTO_INCREMENT,
    street VARCHAR(255) NOT NULL,
    city VARCHAR(100) NOT NULL,
    country_id INT,
    FOREIGN KEY (country_id) REFERENCES country(country_id)
);

CREATE TABLE customer_address (
    customer_id INT,
    address_id INT,
    status_id INT,
    PRIMARY KEY (customer_id, address_id),
    FOREIGN KEY (customer_id) REFERENCES customer(customer_id),
    FOREIGN KEY (address_id) REFERENCES address(address_id),
    FOREIGN KEY (status_id) REFERENCES address_status(status_id)
  
);
  

-- Step 8: Create Orders and Shipping tables
  
CREATE TABLE shipping_method (
    shipping_method_id INT PRIMARY KEY AUTO_INCREMENT,
    method_name VARCHAR(255) NOT NULL
);

CREATE TABLE cust_order (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT,
    order_date DATETIME NOT NULL,
    shipping_method_id INT,
    FOREIGN KEY (customer_id) REFERENCES customer(customer_id),
    FOREIGN KEY (shipping_method_id) REFERENCES shipping_method(shipping_method_id)
);

CREATE TABLE order_status (
    status_id INT PRIMARY KEY AUTO_INCREMENT,
    status_name VARCHAR(50) NOT NULL
);

CREATE TABLE order_line (
    order_line_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT,
    book_id INT,
    quantity INT NOT NULL,
    FOREIGN KEY (order_id) REFERENCES cust_order(order_id),
    FOREIGN KEY (book_id) REFERENCES book(book_id)
);

CREATE TABLE order_history (
    history_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT,
    status_id INT,
    update_timestamp DATETIME NOT NULL,
    FOREIGN KEY (order_id) REFERENCES cust_order(order_id),
    FOREIGN KEY (status_id) REFERENCES order_status(status_id)
);

-- Step 9: Set Up User Roles and Permissions
  
CREATE USER 'admin_user'@'localhost' IDENTIFIED BY 'securepassword';
GRANT ALL PRIVILEGES ON bookstore.* TO 'admin_user'@'localhost';

CREATE USER 'report_user'@'localhost' IDENTIFIED BY 'readonlypassword';
GRANT SELECT ON bookstore.* TO 'report_user'@'localhost';

-- Step 10: Insert Sample Data (Books, Authors, Customers)
  
INSERT INTO publisher (name) VALUES ('Penguin Random House'), ('HarperCollins'), ('Simon & Schuster');
INSERT INTO book_language (language_name) VALUES ('English'), ('French'), ('Spanish');

INSERT INTO book (title, isbn, publication_year, publisher_id, language_id) 
VALUES ('The Catcher in the Rye', '9780316769488', 1951, 1, 1), 
       ('To Kill a Mockingbird', '9780061120084', 1960, 2, 1), 
       ('One Hundred Years of Solitude', '9780060883287', 1967, 2, 3);

INSERT INTO author (name) VALUES ('J.D. Salinger'), ('Harper Lee'), ('Gabriel García Márquez');
INSERT INTO book_author (book_id, author_id) VALUES (1, 1), (2, 2), (3, 3);

INSERT INTO customer (name, email) VALUES ('John Doe', 'john@example.com'), ('Jane Smith', 'jane@example.com');
